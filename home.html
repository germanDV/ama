<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ask Away</title>
    <script>
      window.addEventListener("load", () => {
        const SERVER_URL = "{{.Server}}";
        const form = document.getElementById("newQuestionnaireForm");

        form.onsubmit = async (ev) => {
          ev.preventDefault();
          try {
            const resp = await fetch("{{.Server}}/questionnaires", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ title: ev.target.title.value })
            });

            if (!resp.ok) {
              alert(resp.statusText);
              return;
            }

            const res = await resp.json()
            if (!res?.id) {
              alert("Something went wrong");
              return;
            }

            location.href = location.origin + "/" + res.id
          } catch (err) {
            alert("Something went very wrong")
            console.error(err);
          }
          form.reset();
        }
      });
    </script>
  </head>
  <body>
    <h1>Ask Away</h1>
    <h2>Start a new blank questionnaire and share it with your audience</h2>
    <form id="newQuestionnaireForm">
      <input type="text" name="title" placeholder="Give your questionnaire a title" required value="Todo lo que siempre quiso saber acerca de sexo y nunca se atreviÃ³ a preguntar" />
      <button type="submit">Let's Do It</button>
    </form>
  </body>
</html>
